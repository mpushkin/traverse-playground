<!DOCTYPE html>
<html>
<head lang="en">
	<meta charset="UTF-8">
	<title>Traverse Playground</title>
	<link rel="stylesheet" href="styles.css">
</head>
<body>
	<h1>traverse playground</h1>

	<div id="editor">
console.log('hey there');

for (var i = 0; i < 5; i++) {
	console.log('i =', i);
}
	</div>

	<div id="results"></div>

	<script src="lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
	<script>
		var editor = ace.edit("editor");
		editor.setTheme("ace/theme/monokai");
		editor.getSession().setMode("ace/mode/javascript");
		editor.setShowPrintMargin(false);

		var results = ace.edit("results");
		results.setTheme("ace/theme/monokai");
		results.getSession().setMode("ace/mode/text");
		results.setShowPrintMargin(false);
		results.setReadOnly(true);

		editor.getSession().on('change', updateResult);
		updateResult();

		function updateResult() {
			var code = editor.getValue();
			var result = executeCode(code);
			results.setValue(result);
		}

		function executeCode(code) {
			var results = [];
			try {
				code = code.split('console.log').join('__out');
				var func = new Function('traverse', '__out', code);
				func(myTraverse, out);
				return results.join('\n');
			}
			catch(err) {
				return err.toString();
			}

			function myTraverse(param) {
				console.log(param);
			}

			function out() {
				var args = Array.prototype.slice.call(arguments, 0);
				results.push(args.join(' '));
			}
		}
	</script>

</body>
</html>